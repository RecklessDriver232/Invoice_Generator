<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #2C3E50;
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #34495E;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
        }

        input,
        textarea,
        select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 16px;
            margin-top: 20px;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-success:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            padding: 8px 12px;
            font-size: 12px;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
            padding: 8px 12px;
            font-size: 12px;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-edit {
            background: #16a085;
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            width: 100%;
        }

        .btn-edit:hover {
            background: #138d75;
        }

        .item-row {
            display: grid;
            grid-template-columns: 4fr 1.2fr 1fr 1.2fr 1.2fr 0.8fr;
            gap: 10px;
            margin-bottom: 10px;
            align-items: end;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .item-header {
            font-weight: bold;
            background: #34495E;
            color: white;
            padding: 12px 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            display: grid;
            grid-template-columns: 4fr 1.2fr 1fr 1.2fr 1.2fr 0.8fr;
            gap: 10px;
            align-items: center;
        }

        .item-header-cell {
            text-align: center;
        }

        .item-header-cell:first-child {
            text-align: left;
        }

        .totals-section {
            max-width: 450px;
            margin-left: auto;
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 14px;
            border-bottom: 1px solid #eee;
        }

        .total-row.grand-total {
            font-weight: bold;
            font-size: 18px;
            border-top: 2px solid #34495E;
            border-bottom: none;
            margin-top: 10px;
            padding-top: 15px;
            color: #2C3E50;
        }

        .discount-row {
            color: #e74c3c;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .readonly-input {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        /* Profile Styles */
        .profile-section {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }

        .profile-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .profile-input-group input {
            flex: 1;
        }

        .profile-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .profile-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-card:hover {
            border-color: #3498db;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.2);
        }

        .profile-card.active {
            border-color: #27ae60;
            background: #f0fdf4;
        }

        .profile-card-title {
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 8px;
        }

        .profile-card-company {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .profile-card-actions {
            display: flex;
            gap: 5px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="container">
            <h1>GST Invoice Generator</h1>

            <div v-if="error" class="error">{{ error }}</div>
            <div v-if="success" class="success">{{ success }}</div>

            <!-- Profile Management Section -->
            <div class="profile-section">
                <div class="section-title">Profile Management</div>

                <!-- Save New Profile -->
                <div class="profile-input-group">
                    <input v-model="newProfileName" type="text" placeholder="Enter profile name..."
                        @keyup.enter="saveProfile">
                    <button @click="saveProfile" class="btn btn-primary">Save Profile</button>
                </div>

                <!-- Edit Profile Button (only shows if loaded and changed) -->
                <div v-if="selectedProfileId && hasChanges" style="margin-bottom: 15px;">
                    <button @click="confirmEditProfile" class="btn btn-edit">
                        ✏️ Update Changes to "{{ getSelectedProfileName() }}"
                    </button>
                </div>

                <!-- Saved Profiles -->
                <div v-if="profiles.length > 0">
                    <p style="margin-bottom: 10px; color: #555;">Click a profile to load it:</p>
                    <div class="profile-list">
                        <div v-for="profile in profiles" :key="profile.id" class="profile-card"
                            :class="{ active: selectedProfileId === profile.id && !hasChanges }">
                            <div class="profile-card-title">{{ profile.name }}</div>
                            <div class="profile-card-company">{{ profile.company_info.name }}</div>
                            <div class="profile-card-actions">
                                <button @click="loadProfile(profile.id)" class="btn btn-warning"
                                    style="flex: 1;">Load</button>
                                <button @click="deleteProfile(profile.id)" class="btn btn-danger"
                                    style="flex: 1;">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
                <p v-else style="color: #95a5a6; font-style: italic;">No profiles saved yet</p>
            </div>

            <form @submit.prevent="generateInvoice">

                <!-- Invoice Details -->
                <div class="form-section">
                    <div class="section-title">Invoice Details</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Invoice Number *</label>
                            <input v-model="invoice.invoice_number" type="text" placeholder="e.g., 001" required>
                        </div>
                        <div class="form-group">
                            <label>Invoice Date *</label>
                            <input v-model="invoice.invoice_date" type="date" required>
                        </div>
                        <div class="form-group">
                            <label>PO Number</label>
                            <input v-model="invoice.po_number" type="text" placeholder="Optional">
                        </div>
                    </div>
                </div>

                <!-- Tax Rate Configuration -->
                <div class="form-section">
                    <div class="section-title">Tax Rate Configuration</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>CGST Rate (%) *</label>
                            <input v-model.number="invoice.cgst_rate" type="number" step="0.01" min="0" max="100"
                                required>
                        </div>
                        <div class="form-group">
                            <label>SGST Rate (%) *</label>
                            <input v-model.number="invoice.sgst_rate" type="number" step="0.01" min="0" max="100"
                                required>
                        </div>
                        <div class="form-group">
                            <label>IGST Rate (%) *</label>
                            <input v-model.number="invoice.igst_rate" type="number" step="0.01" min="0" max="100"
                                required>
                        </div>
                    </div>
                </div>

                <!-- Seller and Buyer Details -->
                <div class="two-column">
                    <!-- Seller (Company) Details -->
                    <div class="form-section">
                        <div class="section-title">Your Company Details</div>
                        <div class="form-group">
                            <label>Company Name *</label>
                            <input v-model="invoice.company_info.name" type="text" required>
                        </div>
                        <div class="form-group">
                            <label>Address *</label>
                            <textarea v-model="invoice.company_info.address" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>City *</label>
                                <input v-model="invoice.company_info.city" type="text" required>
                            </div>
                            <div class="form-group">
                                <label>State *</label>
                                <input v-model="invoice.company_info.state" type="text" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Pincode *</label>
                                <input v-model="invoice.company_info.pincode" type="text" required>
                            </div>
                            <div class="form-group">
                                <label>GSTIN *</label>
                                <input v-model="invoice.company_info.gstin" type="text" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input v-model="invoice.company_info.email" type="email" required>
                        </div>
                    </div>

                    <!-- Buyer Details -->
                    <div class="form-section">
                        <div class="section-title">Buyer Details</div>
                        <div class="form-group">
                            <label>Company Name *</label>
                            <input v-model="invoice.buyer_info.name" type="text" required>
                        </div>
                        <div class="form-group">
                            <label>Address *</label>
                            <textarea v-model="invoice.buyer_info.address" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>City *</label>
                                <input v-model="invoice.buyer_info.city" type="text" required>
                            </div>
                            <div class="form-group">
                                <label>State *</label>
                                <input v-model="invoice.buyer_info.state" type="text" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Pincode *</label>
                                <input v-model="invoice.buyer_info.pincode" type="text" required>
                            </div>
                            <div class="form-group">
                                <label>GSTIN</label>
                                <input v-model="invoice.buyer_info.gstin" type="text" placeholder="Optional">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Items Section -->
                <div class="form-section">
                    <div class="section-title">Invoice Items</div>

                    <div class="item-header">
                        <div class="item-header-cell">Name of Product</div>
                        <div class="item-header-cell">HSN/SAC</div>
                        <div class="item-header-cell">Qty</div>
                        <div class="item-header-cell">Rate</div>
                        <div class="item-header-cell">Amount</div>
                        <div class="item-header-cell">Action</div>
                    </div>

                    <div v-for="(item, index) in invoice.items" :key="index" class="item-row">
                        <div class="form-group">
                            <input v-model="item.description" type="text" placeholder="Name of product" required>
                        </div>
                        <div class="form-group">
                            <input v-model="item.hsn_code" type="text" placeholder="HSN/SAC">
                        </div>
                        <div class="form-group">
                            <input v-model.number="item.quantity" type="number" step="1" min="1" placeholder="1"
                                required>
                        </div>
                        <div class="form-group">
                            <input v-model.number="item.rate" type="number" step="0.01" min="0" placeholder="0.00"
                                required>
                        </div>
                        <div class="form-group">
                            <input :value="(item.quantity * item.rate).toFixed(2)" type="text" readonly
                                class="readonly-input">
                        </div>
                        <button type="button" @click="removeItem(index)" class="btn btn-danger"
                            v-if="invoice.items.length > 1">
                            ✕
                        </button>
                    </div>

                    <button type="button" @click="addItem" class="btn btn-primary" style="margin-top: 15px;">
                        + Add Item
                    </button>
                </div>

                <!-- Totals Display -->
                <div class="totals-section">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span>{{ subtotal.toFixed(2) }}</span>
                    </div>
                    <div v-if="discountAmount > 0" class="total-row discount-row">
                        <span v-if="discountType === 'percentage'">Discount ({{ discountValue }}%):</span>
                        <span v-else>Discount:</span>
                        <span>-{{ discountAmount.toFixed(2) }}</span>
                    </div>
                    <div v-if="discountAmount > 0" class="total-row">
                        <span>After Discount:</span>
                        <span>{{ subtotalAfterDiscount.toFixed(2) }}</span>
                    </div>
                    <div class="total-row" v-if="isSameState">
                        <span>CGST ({{ invoice.cgst_rate }}%):</span>
                        <span>{{ cgstAmount.toFixed(2) }}</span>
                    </div>
                    <div class="total-row" v-if="isSameState">
                        <span>SGST ({{ invoice.sgst_rate }}%):</span>
                        <span>{{ sgstAmount.toFixed(2) }}</span>
                    </div>
                    <div class="total-row" v-if="!isSameState">
                        <span>IGST ({{ invoice.igst_rate }}%):</span>
                        <span>{{ igstAmount.toFixed(2) }}</span>
                    </div>
                    <div class="total-row">
                        <span>Shipping Charges:</span>
                        <span>{{ shippingCharges.toFixed(2) }}</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Total:</span>
                        <span>{{ totalAmount.toFixed(2) }}</span>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-section">
                    <div class="section-title">Additional Information</div>

                    <!-- Discount Section -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Discount Type</label>
                            <select v-model="discountType">
                                <option value="none">No Discount</option>
                                <option value="percentage">Percentage (%)</option>
                                <option value="amount">Fixed Amount (₹)</option>
                            </select>
                        </div>
                        <div v-if="discountType !== 'none'" class="form-group">
                            <label>{{ discountType === 'percentage' ? 'Discount (%)' : 'Discount Amount (₹)' }}</label>
                            <input v-model.number="discountValue" type="number" step="0.01" min="0"
                                :max="discountType === 'percentage' ? 100 : subtotal" placeholder="0.00">
                        </div>
                    </div>

                    <!-- Shipping Charges -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Shipping Charges</label>
                            <input v-model.number="shippingCharges" type="number" step="0.01" min="0"
                                placeholder="0.00">
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-success" :disabled="loading">
                    {{ loading ? 'Generating PDF...' : 'Generate Invoice PDF' }}
                </button>
            </form>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    invoice: {
                        invoice_number: '',
                        invoice_date: new Date().toISOString().split('T')[0],
                        po_number: '',
                        cgst_rate: 9,
                        sgst_rate: 9,
                        igst_rate: 18,
                        company_info: {
                            name: '',
                            address: '',
                            city: '',
                            state: '',
                            pincode: '',
                            gstin: '',
                            email: ''
                        },
                        buyer_info: {
                            name: '',
                            address: '',
                            city: '',
                            state: '',
                            pincode: '',
                            gstin: ''
                        },
                        items: [
                            {
                                description: '',
                                hsn_code: '',
                                quantity: 1,
                                rate: 0
                            }
                        ]
                    },
                    shippingCharges: 0,
                    discountType: 'none',
                    discountValue: 0,
                    loading: false,
                    error: null,
                    success: null,
                    profiles: [],
                    newProfileName: '',
                    selectedProfileId: null,
                    originalProfileData: null,
                    hasChanges: false
                }
            },
            computed: {
                subtotal() {
                    return this.invoice.items.reduce((sum, item) => {
                        return sum + (item.quantity * item.rate);
                    }, 0);
                },
                discountAmount() {
                    if (this.discountType === 'none') return 0;
                    if (this.discountType === 'percentage') {
                        return this.subtotal * (this.discountValue / 100);
                    }
                    return this.discountValue;
                },
                subtotalAfterDiscount() {
                    return this.subtotal - this.discountAmount;
                },
                isSameState() {
                    return this.invoice.company_info.state.trim().toLowerCase() ===
                        this.invoice.buyer_info.state.trim().toLowerCase();
                },
                cgstAmount() {
                    return this.isSameState ? this.subtotalAfterDiscount * (this.invoice.cgst_rate / 100) : 0;
                },
                sgstAmount() {
                    return this.isSameState ? this.subtotalAfterDiscount * (this.invoice.sgst_rate / 100) : 0;
                },
                igstAmount() {
                    return !this.isSameState ? this.subtotalAfterDiscount * (this.invoice.igst_rate / 100) : 0;
                },
                totalAmount() {
                    return this.subtotalAfterDiscount + this.cgstAmount + this.sgstAmount + this.igstAmount + this.shippingCharges;
                }
            },
            watch: {
                invoice: {
                    handler() {
                        this.checkForChanges();
                    },
                    deep: true
                },
                shippingCharges() {
                    this.checkForChanges();
                },
                discountType() {
                    this.checkForChanges();
                },
                discountValue() {
                    this.checkForChanges();
                }
            },
            methods: {
                addItem() {
                    this.invoice.items.push({
                        description: '',
                        hsn_code: '',
                        quantity: 1,
                        rate: 0
                    });
                },
                removeItem(index) {
                    if (this.invoice.items.length > 1) {
                        this.invoice.items.splice(index, 1);
                    }
                },
                saveProfile() {
                    if (!this.newProfileName.trim()) {
                        this.error = 'Please enter a profile name';
                        return;
                    }

                    const profile = {
                        id: Date.now(),
                        name: this.newProfileName,
                        invoice_number: this.invoice.invoice_number,
                        po_number: this.invoice.po_number,
                        cgst_rate: this.invoice.cgst_rate,
                        sgst_rate: this.invoice.sgst_rate,
                        igst_rate: this.invoice.igst_rate,
                        company_info: JSON.parse(JSON.stringify(this.invoice.company_info)),
                        buyer_info: JSON.parse(JSON.stringify(this.invoice.buyer_info)),
                        items: JSON.parse(JSON.stringify(this.invoice.items)),
                        shippingCharges: this.shippingCharges,
                        discountType: this.discountType,
                        discountValue: this.discountValue,
                        createdAt: new Date().toISOString()
                    };

                    this.profiles.push(profile);
                    this.saveToLocalStorage();
                    this.newProfileName = '';
                    this.success = `Profile "${profile.name}" saved successfully!`;
                    setTimeout(() => { this.success = null; }, 2000);
                },
                loadProfile(profileId) {
                    const profile = this.profiles.find(p => p.id === profileId);
                    if (!profile) return;

                    this.selectedProfileId = profileId;
                    this.originalProfileData = JSON.parse(JSON.stringify(profile));

                    this.invoice.invoice_number = profile.invoice_number;
                    this.invoice.po_number = profile.po_number;
                    this.invoice.cgst_rate = profile.cgst_rate;
                    this.invoice.sgst_rate = profile.sgst_rate;
                    this.invoice.igst_rate = profile.igst_rate;
                    this.invoice.company_info = JSON.parse(JSON.stringify(profile.company_info));
                    this.invoice.buyer_info = JSON.parse(JSON.stringify(profile.buyer_info));
                    this.invoice.items = JSON.parse(JSON.stringify(profile.items));
                    this.shippingCharges = profile.shippingCharges;
                    this.discountType = profile.discountType || 'none';
                    this.discountValue = profile.discountValue || 0;

                    this.hasChanges = false;
                    this.success = `Profile "${profile.name}" loaded successfully!`;
                    setTimeout(() => { this.success = null; }, 2000);
                },
                deleteProfile(profileId) {
                    if (confirm('Are you sure you want to delete this profile?')) {
                        const index = this.profiles.findIndex(p => p.id === profileId);
                        if (index > -1) {
                            const profileName = this.profiles[index].name;
                            this.profiles.splice(index, 1);
                            this.saveToLocalStorage();
                            if (this.selectedProfileId === profileId) {
                                this.selectedProfileId = null;
                                this.originalProfileData = null;
                                this.hasChanges = false;
                            }
                            this.success = `Profile "${profileName}" deleted!`;
                            setTimeout(() => { this.success = null; }, 2000);
                        }
                    }
                },
                confirmEditProfile() {
                    const profileName = this.getSelectedProfileName();
                    if (confirm(`Are you sure you want to update "${profileName}" with these changes?`)) {
                        this.updateProfile();
                    }
                },
                updateProfile() {
                    const profile = this.profiles.find(p => p.id === this.selectedProfileId);
                    if (!profile) return;

                    profile.invoice_number = this.invoice.invoice_number;
                    profile.po_number = this.invoice.po_number;
                    profile.cgst_rate = this.invoice.cgst_rate;
                    profile.sgst_rate = this.invoice.sgst_rate;
                    profile.igst_rate = this.invoice.igst_rate;
                    profile.company_info = JSON.parse(JSON.stringify(this.invoice.company_info));
                    profile.buyer_info = JSON.parse(JSON.stringify(this.invoice.buyer_info));
                    profile.items = JSON.parse(JSON.stringify(this.invoice.items));
                    profile.shippingCharges = this.shippingCharges;
                    profile.discountType = this.discountType;
                    profile.discountValue = this.discountValue;

                    this.originalProfileData = JSON.parse(JSON.stringify(profile));
                    this.hasChanges = false;
                    this.saveToLocalStorage();
                    this.success = `Profile "${profile.name}" updated successfully!`;
                    setTimeout(() => { this.success = null; }, 2000);
                },
                getSelectedProfileName() {
                    const profile = this.profiles.find(p => p.id === this.selectedProfileId);
                    return profile ? profile.name : '';
                },
                checkForChanges() {
                    if (!this.selectedProfileId || !this.originalProfileData) {
                        this.hasChanges = false;
                        return;
                    }

                    const currentData = {
                        invoice_number: this.invoice.invoice_number,
                        po_number: this.invoice.po_number,
                        cgst_rate: this.invoice.cgst_rate,
                        sgst_rate: this.invoice.sgst_rate,
                        igst_rate: this.invoice.igst_rate,
                        company_info: this.invoice.company_info,
                        buyer_info: this.invoice.buyer_info,
                        items: this.invoice.items,
                        shippingCharges: this.shippingCharges,
                        discountType: this.discountType,
                        discountValue: this.discountValue
                    };

                    this.hasChanges = JSON.stringify(currentData) !== JSON.stringify({
                        invoice_number: this.originalProfileData.invoice_number,
                        po_number: this.originalProfileData.po_number,
                        cgst_rate: this.originalProfileData.cgst_rate,
                        sgst_rate: this.originalProfileData.sgst_rate,
                        igst_rate: this.originalProfileData.igst_rate,
                        company_info: this.originalProfileData.company_info,
                        buyer_info: this.originalProfileData.buyer_info,
                        items: this.originalProfileData.items,
                        shippingCharges: this.originalProfileData.shippingCharges,
                        discountType: this.originalProfileData.discountType || 'none',
                        discountValue: this.originalProfileData.discountValue || 0
                    });
                },
                saveToLocalStorage() {
                    localStorage.setItem('invoiceProfiles', JSON.stringify(this.profiles));
                },
                loadFromLocalStorage() {
                    const data = localStorage.getItem('invoiceProfiles');
                    if (data) {
                        this.profiles = JSON.parse(data);
                    }
                },
                async generateInvoice() {
                    this.loading = true;
                    this.error = null;
                    this.success = null;

                    try {
                        if (this.invoice.items.length === 0) {
                            throw new Error('Please add at least one item');
                        }

                        const response = await fetch('http://localhost:5000/api/generate-invoice', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                ...this.invoice,
                                shipping_charges: this.shippingCharges,
                                discount_type: this.discountType,
                                discount_value: this.discountValue,
                                discount_amount: this.discountAmount
                            })
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to generate invoice');
                        }

                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `Invoice_${this.invoice.invoice_number}.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);

                        this.success = 'Invoice generated and downloaded successfully!';
                        setTimeout(() => {
                            this.success = null;
                        }, 3000);

                    } catch (error) {
                        this.error = error.message;
                        console.error('Error:', error);
                    } finally {
                        this.loading = false;
                    }
                }
            },
            mounted() {
                this.loadFromLocalStorage();
            }
        }).mount('#app');
    </script>
</body>

</html>